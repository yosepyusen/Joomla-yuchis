"use strict";
/**
 * @license Copyright (c) 2003-2016, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or http://ckeditor.com/license
 */
CKEDITOR.dialog.add("image2",function(n){function st(){var n=this.getValue().match(tt),t=!!(n&&parseInt(n[1],10)!==0);return t||alert(r["invalid"+CKEDITOR.tools.capitalize(this.id)]),t}function vt(){function t(t,u){i.push(n.once(t,function(n){r();u(n)}))}function r(){for(var n;n=i.pop();)n.removeListener()}var n=a.createElement("img"),i=[];return function(i,r,u){t("load",function(){var t=ft(n);r.call(u,n,t.width,t.height)});t("error",function(){r(null)});t("abort",function(){r(null)});n.setAttribute("src",(w.baseHref||"")+i+"?"+Math.random().toString(16).substring(2))}}function ht(){var t=this.getValue();p(!1);t!==k.data.src?(ot(t,function(t,i,r){if(p(!0),!t)return l(!1);f.setValue(n.config.image2_prefillDimensions===!1?0:i);e.setValue(n.config.image2_prefillDimensions===!1?0:r);v=i;y=r;l(ut.checkHasNaturalRatio(t))}),h=!0):h?(p(!0),f.setValue(o),e.setValue(s),h=!1):p(!0)}function ct(){var n;if(i&&(n=this.getValue(),n)&&(n.match(tt)||l(!1),n!=="0")){var t=this.id=="width",r=o||v,u=s||y;n=t?Math.round(u*(n/r)):Math.round(r*(n/u));isNaN(n)||(t?e:f).setValue(n)}}function yt(){function t(n){n.on("mouseover",function(){this.addClass("cke_btn_over")},n);n.on("mouseout",function(){this.removeClass("cke_btn_over")},n)}var n=this.getDialog();if(u=a.getById(it),c=a.getById(rt),u){n.addFocusable(u,4+nt);u.on("click",function(n){l();n.data&&n.data.preventDefault()},this.getDialog());t(u)}if(c){n.addFocusable(c,5+nt);c.on("click",function(n){h?(f.setValue(v),e.setValue(y)):(f.setValue(o),e.setValue(s));n.data&&n.data.preventDefault()},this);t(c)}}function l(n){var t,r,h;if(u){if(typeof n=="boolean"){if(d)return;i=n}else t=f.getValue(),d=!0,i=!i,i&&t&&(r=s/o*t,isNaN(r)||e.setValue(Math.round(r)));u[i?"removeClass":"addClass"]("cke_btn_unlocked");u.setAttribute("aria-checked",i);CKEDITOR.env.hc&&(h=u.getChild(0),h.setHtml(i?CKEDITOR.env.ie?"■":"▣":CKEDITOR.env.ie?"□":"▢"))}}function p(n){var t=n?"enable":"disable";f[t]();e[t]()}var tt=/(^\s*(\d+)(px)?\s*$)|^$/i,it=CKEDITOR.tools.getNextId(),rt=CKEDITOR.tools.getNextId(),t=n.lang.image2,r=n.lang.common,at=new CKEDITOR.template('<div><a href="javascript:void(0)" tabindex="-1" title="'+t.lockRatio+'" class="cke_btn_locked" id="{lockButtonId}" role="checkbox"><span class="cke_icon"><\/span><span class="cke_label">'+t.lockRatio+'<\/span><\/a><a href="javascript:void(0)" tabindex="-1" title="'+t.resetSize+'" class="cke_btn_reset" id="{resetButtonId}" role="button"><span class="cke_label">'+t.resetSize+"<\/span><\/a><\/div>").output({lockButtonId:it,resetButtonId:rt}),ut=CKEDITOR.plugins.image2,w=n.config,b=n.widgets.registered.image.features,ft=ut.getNatural,a,k,et,ot,o,s,v,y,h,i,d,u,c,f,e,g,nt=!!(w.filebrowserImageBrowseUrl||w.filebrowserBrowseUrl),lt=[{id:"src",type:"text",label:r.url,onKeyup:ht,onChange:ht,setup:function(n){this.setValue(n.data.src)},commit:function(n){n.setData("src",this.getValue())},validate:CKEDITOR.dialog.validate.notEmpty(t.urlMissing)}];return nt&&lt.push({type:"button",id:"browse",style:"display:inline-block;margin-top:14px;",align:"center",label:n.lang.common.browseServer,hidden:!0,filebrowser:"info:src"}),{title:t.title,minWidth:250,minHeight:100,onLoad:function(){a=this._.element.getDocument();ot=vt()},onShow:function(){k=this.widget;et=k.parts.image;h=d=i=!1;g=ft(et);v=o=g.width;y=s=g.height},contents:[{id:"info",label:t.infoTab,elements:[{type:"vbox",padding:0,children:[{type:"hbox",widths:["100%"],children:lt}]},{id:"alt",type:"text",label:t.alt,setup:function(n){this.setValue(n.data.alt)},commit:function(n){n.setData("alt",this.getValue())}},{type:"hbox",widths:["25%","25%","50%"],requiredContent:b.dimension.requiredContent,children:[{type:"text",width:"45px",id:"width",label:r.width,validate:st,onKeyUp:ct,onLoad:function(){f=this},setup:function(n){this.setValue(n.data.width)},commit:function(n){n.setData("width",this.getValue())}},{type:"text",id:"height",width:"45px",label:r.height,validate:st,onKeyUp:ct,onLoad:function(){e=this},setup:function(n){this.setValue(n.data.height)},commit:function(n){n.setData("height",this.getValue())}},{id:"lock",type:"html",style:"margin-top:18px;width:40px;height:20px;",onLoad:yt,setup:function(n){l(n.data.lock)},commit:function(n){n.setData("lock",i)},html:at}]},{type:"hbox",id:"alignment",requiredContent:b.align.requiredContent,children:[{id:"align",type:"radio",items:[[r.alignNone,"none"],[r.alignLeft,"left"],[r.alignCenter,"center"],[r.alignRight,"right"]],label:r.align,setup:function(n){this.setValue(n.data.align)},commit:function(n){n.setData("align",this.getValue())}}]},{id:"hasCaption",type:"checkbox",label:t.captioned,requiredContent:b.caption.requiredContent,setup:function(n){this.setValue(n.data.hasCaption)},commit:function(n){n.setData("hasCaption",this.getValue())}}]},{id:"Upload",hidden:!0,filebrowser:"uploadButton",label:t.uploadTab,elements:[{type:"file",id:"upload",label:t.btnUpload,style:"height:40px"},{type:"fileButton",id:"uploadButton",filebrowser:"info:src",label:t.btnUpload,"for":["Upload","upload"]}]}]}})