(function(){function t(n){var t=n.getSelectedWidget()||null;return t?t.data.hasCaption||t.data.align=="center"?(t.parts.image.data("cke-align",t.data.align!="none"&&t.data.align||""),!t.data.hasCaption)?t.parts.image:t.element:(t.element.data("cke-align",t.data.align!="none"&&t.data.align||""),t.element):!1}var n="arkimage";CKEDITOR.plugins.add("imagemanager",{requires:"image",icons:"image",hidpi:!0,init:function(i){var r={href:i.config.base+"index.php?option=com_media&view=images&tmpl=component&e_name={EDITOR}&asset=com_content&arkimage=1&author=",exec:function(n){var f,e,i,r,u;this.href=this.href.replace("{EDITOR}",n.name);f=this;e=function(n){n.cancel()};n.editable().once("blur",e,null,null,-100);if(jQuery.fn.squeezeBox?jQuery.fn.squeezeBox({handler:"iframe",size:{x:800,y:500},url:this.href},!0):SqueezeBox.open(null,{handler:"iframe",size:{x:800,y:500},url:this.href}),i=t(n),i){if(r=function(){var t=n.getSelection();CKEDITOR.env.ie&&t&&(n._bookmarks=t.createBookmarks2());CKEDITOR.tools.setTimeout(function(){if(typeof SqueezeBox=="object")SqueezeBox.removeEvent("onOpen",r);else jQuery(ARK.squeezeBox).on("onOpen",r)},0,f)},u=function(){var t=CKEDITOR.document.getById("sbox-window").findOne("#sbox-content iframe");t.on("load",function(){var s=t.getFrameDocument(),e=s.getWindow().$.ImageManager,o,h,c,r;e.populateElementValues||(e.populateElementValues=function(t){var r=(t.data("cke-saved-src")||t.getAttribute("src")).replace(n.config.base,""),i;this.fields.url.value=r;this.fields.alt.value=t.getAttribute("alt");this.fields.title.value=t.getAttribute("title");t.data("caption")&&(this.fields.caption.value=t.data("caption"),this.fields.c_class.value=t.data("captionClass"));this.fields.align.value=t.data("cke-align");i=this.fields.align.options[this.fields.align.selectedIndex].text;s.findOne("#f_align_chzn a.chzn-single span").setText(i);t.data("class",!1)});i.is("figure")?(r=i.findOne("img"),o=i.findOne("figcaption"),o.removeClass("cke_widget_editable"),h=o.getAttribute("class"),r.data("caption",o.getText()||""),r.data("captionClass",h||""),c=i.getAttribute("class"),r.data("class",c||""),e.populateElementValues(r,n)):i.is("a")?(r=i.findOne("img"),r.data("cke-align",i.data("cke-align")),e.populateElementValues(r,n)):e.populateElementValues(i,n);CKEDITOR.tools.setTimeout(function(){if(typeof SqueezeBox=="object")SqueezeBox.removeEvent("onOpen",u);else jQuery(ARK.squeezeBox).on("onOpen",u)},0,f)})},CKEDITOR.env.ie)if(typeof SqueezeBox=="object")SqueezeBox.addEvent("onOpen",r);else jQuery(ARK.squeezeBox).on("onOpen",r);if(typeof SqueezeBox=="object")SqueezeBox.addEvent("onOpen",u);else jQuery(ARK.squeezeBox).on("onOpen",u)}}},u=i.addCommand(n,r);u.modes={wysiwyg:1};i.widgets.onWidget("image","ready",function(){this.on("doubleclick",function(){return i.execCommand(n),!1},null,null,5)})},afterInit:function(t){if(!t.config.arkMediaEnabled){t.removeMenuItem&&t.removeMenuItem("image");t.addMenuItems&&t.addMenuItems({image:{label:t.lang.image.menu,command:n,group:"image"}});t.ui.addButton&&t.ui.addButton("Image",{label:t.lang.common.image,command:n});t.on("blur",function(){t.elementMode==CKEDITOR.ELEMENT_MODE_INLINE&&(t.widgets.selectedWidget=null)})}}})})()