/**
 * @license Copyright (c) 2003-2016, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or http://ckeditor.com/license
 */
(function(){function t(n){return CKEDITOR.env.ie?n.$.clientWidth:parseInt(n.getComputedStyle("width"),10)}function i(n,t){var i=n.getComputedStyle("border-"+t+"-width"),r={thin:"0px",medium:"1px",thick:"2px"};return i.indexOf("px")<0&&(i=i in r&&n.getComputedStyle("border-style")!="none"?r[i]:0),parseInt(i,10)}function o(n){for(var u=n.$.rows,f=0,t,e,i,r=0,o=u.length;r<o;r++)i=u[r],t=i.cells.length,t>f&&(f=t,e=i);return e}function s(n){for(var r,u,e,c,y,t,l=[],a=-1,s=n.getComputedStyle("direction")=="rtl",h=o(n),v=new CKEDITOR.dom.element(n.$.tBodies[0]),p=v.getDocumentPosition(),f=0,w=h.cells.length;f<w;f++)r=new CKEDITOR.dom.element(h.cells[f]),u=h.cells[f+1]&&new CKEDITOR.dom.element(h.cells[f+1]),a+=r.$.colSpan||1,t=r.getDocumentPosition().x,s?c=t+i(r,"left"):e=t+r.$.offsetWidth-i(r,"right"),u?(t=u.getDocumentPosition().x,s?e=t+u.$.offsetWidth-i(u,"right"):c=t+i(u,"left")):(t=n.getDocumentPosition().x,s?e=t:c=t+n.$.offsetWidth),y=Math.max(c-e,3),l.push({table:n,index:a,x:e,y:p.y,width:y,height:v.$.offsetHeight,rtl:s});return l}function h(n,t){for(var i,r=0,u=n.length;r<u;r++)if(i=n[r],t>=i.x&&t<=i.x+i.width)return i;return null}function u(n){(n.data||n).preventDefault()}function c(f){function nt(){s=null;l=0;c=0;h.removeListener("mouseup",k);o.removeListener("mousedown",b);o.removeListener("mousemove",d);h.getBody().setStyle("cursor","auto");r?o.remove():o.hide()}function tt(){for(var b=s.index,k=CKEDITOR.tools.buildTableMap(s.table),g=[],nt=[],r=Number.MAX_VALUE,f=r,tt=s.rtl,e=0,rt=k.length;e<rt;e++){var it=k[e],n=it[b+(tt?1:0)],i=it[b+(tt?0:1)];n=n&&new CKEDITOR.dom.element(n);i=i&&new CKEDITOR.dom.element(i);n&&i&&n.equals(i)||(n&&(r=Math.min(r,t(n))),i&&(f=Math.min(f,t(i))),g.push(n),nt.push(i))}a=g;v=nt;y=s.x-r;p=s.x+f;o.setOpacity(.5);w=parseInt(o.getStyle("left"),10);l=0;c=1;o.on("mousemove",d);h.on("dragstart",u)}function it(){var n,i,r;c=0;o.setOpacity(0);l&&rt();n=s.table;setTimeout(function(){n.removeCustomData("_cke_table_pillars")},0);h.removeListener("dragstart",u);i=n.$.rows;r=t(n);f.on("resizedColumn",function(){CKEDITOR.tools.setTimeout(function(){for(var f,u,n,o,t=0;f=i[t];t++)for(u=0;n=f.cells[u];u++)o=CKEDITOR.env.ie?n.clientWidth:parseInt(e(CKEDITOR.dom.element.get(n),"width"),10),n.style.width=Math.round(100*o/r)+"%"},10,this)},this)}function rt(){for(var h=s.rtl,c=h?v.length:a.length,y=0,r=0;r<c;r++){var u=a[r],e=v[r],o=s.table;CKEDITOR.tools.setTimeout(function(t,i,r,u,e,s){t&&t.setStyle("width",n(Math.max(i+s,1)));r&&r.setStyle("width",n(Math.max(u-s,1)));e&&o.setStyle("width",n(e+s*(h?-1:1)));++y==c&&(f.fire("saveSnapshot"),f.fire("resizedColumn"))},0,this,[u,u&&t(u),e,e&&t(e),(!u||!e)&&t(o)+i(o,"left")+i(o,"right"),l])}}function b(n){u(n);f.fire("saveSnapshot");tt();h.on("mouseup",k,this)}function k(n){n.removeListener();it()}function d(n){g(n.data.getPageOffset().x)}var s,h,o,c,w,l,a,v,y,p,g;h=f.document;o=CKEDITOR.dom.element.createFromHtml('<div data-cke-temp=1 contenteditable=false unselectable=on style="position:absolute;cursor:col-resize;filter:alpha(opacity=0);opacity:0;padding:0;background-color:#004;background-image:none;border:0px none;z-index:10"><\/div>',h);f.on("destroy",function(){o.remove()});r||h.getDocumentElement().append(o);this.attachTo=function(t){if(!c){r&&(h.getBody().append(o),l=0);s=t;o.setStyles({width:n(t.width),height:n(t.height),left:n(t.x),top:n(t.y)});r&&o.setOpacity(.25);o.on("mousedown",b,this);h.getBody().setStyle("cursor","col-resize");o.show()}};g=this.move=function(t){if(!s)return 0;if(!c&&(t<s.x||t>s.x+s.width))return nt(),0;var i=t-Math.round(o.$.offsetWidth/2);if(c){if(i==y||i==p)return 1;i=Math.max(i,y);i=Math.min(i,p);l=i-w}return o.setStyle("left",n(i)),1}}function f(n){var i=n.data.getTarget(),t;if(n.name=="mouseout"){if(!i.is("table"))return;for(t=new CKEDITOR.dom.element(n.data.$.relatedTarget||n.data.$.toElement);t&&t.$&&!t.equals(i)&&!t.is("body");)t=t.getParent();if(!t||t.equals(i))return}i.getAscendant("table",1).removeCustomData("_cke_table_pillars");n.removeListener()}var n=CKEDITOR.tools.cssLength,r=CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.quirks),e=document.defaultView&&document.defaultView.getComputedStyle?function(n,t){var i=n.getWindow().$&&n.getWindow().$.getComputedStyle(n.$,null);return i?i.getPropertyValue(t):""}:function(n,t){return n.$.currentStyle[CKEDITOR.tools.cssStyleToDomStyle(t)]};CKEDITOR.plugins.add("tableresize",{requires:"tabletools",init:function(n){n.on("contentDom",function(){var t,i=n.editable();i.attachListener(i.isInline()?i:n.document,"mousemove",function(i){var e,o,r,l,a;if(i=i.data,e=i.getTarget(),e.type==CKEDITOR.NODE_ELEMENT){if(o=i.getPageOffset().x,t&&t.move(o)){u(i);return}if((e.is("table")||e.getAscendant("tbody",1))&&(r=e.getAscendant("table",1),n.editable().contains(r))){if(!(l=r.getCustomData("_cke_table_pillars"))){r.setCustomData("_cke_table_pillars",l=s(r));r.on("mouseout",f);r.on("mousedown",f)}a=h(l,o);a&&(t||(t=new c(n)),t.attachTo(a))}}})})}})})()