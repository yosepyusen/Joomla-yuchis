(function(){var n="arklink",t=/(?:[^\/])\/(([^\u0000-\u007F]|[\w-])+\.(?!(?:htm|php|asp|jsp|cfm|pl|cgi))\w+)$/;CKEDITOR.plugins.add("document",{lang:"en,de,es,fi,fr,he,it,nl,ru,zh-cn",icons:"document",hidpi:!1,init:function(i){var u={href:i.config.base+"index.php?option=com_media&view=images&tmpl=component&e_name={EDITOR}&asset=com_content&arkmedia=1&author=",exec:function(n){var f=CKEDITOR.plugins.link,t=null,e,o,i,r,u;this.href=this.href.replace("{EDITOR}",n.name);e=this;o=function(n){n.cancel()};n.editable().once("blur",o,null,null,-100);if(jQuery.fn.squeezeBox?jQuery.fn.squeezeBox({handler:"iframe",size:{x:800,y:500},url:this.href},!0):SqueezeBox.open(null,{handler:"iframe",size:{x:800,y:500},url:this.href}),i=n.getSelection(),t=f.getSelectedLink2(n)&&f.getSelectedLink2(n).hasAttribute("href")&&f.getSelectedLink2(n)||i&&(i.getSelectedElement()&&i.getSelectedElement().getOuterHtml()||i.getSelectedText())){if(r=function(){var t=n.getSelection();CKEDITOR.env.ie&&t&&(n._bookmarks=t.createBookmarks2());CKEDITOR.tools.setTimeout(function(){typeof SqueezeBox=="object"?SqueezeBox.removeEvent("onOpen",r):jQuery(ARK.squeezeBox).off("onOpen",r)},0,e)},u=function(){var i=CKEDITOR.document.getById("sbox-window").findOne("#sbox-content iframe");i.on("load",function(){var f=i.getFrameDocument(),r=f.getWindow().$.MediaManager;r.populateElementValues||(r.populateElementValues=function(t){var i,r;this.html=t.getHtml();i=(t.data("cke-saved-href")||t.getAttribute("href")).replace(n.config.base,"");this.fields.url.value=i;this.fields.rel.value=t.getAttribute("rel");this.fields.title.value=t.getAttribute("title");this.fields.text.value=t.getText();target=t.getAttribute("target")||"";this.fields.target.value=target;r=this.fields.target.options[this.fields.target.selectedIndex].text;f.findOne("#f_target_chzn a.chzn-single span").setText(r)});typeof t=="string"&&(t=CKEDITOR.dom.element.createFromHtml('<a href="" rel="" title="">'+t+"<\/a>"));r.populateElementValues(t,n);CKEDITOR.tools.setTimeout(function(){typeof SqueezeBox=="object"?SqueezeBox.removeEvent("onOpen",u):jQuery(ARK.squeezeBox).off("onOpen",u)},0,e)})},CKEDITOR.env.ie)if(typeof SqueezeBox=="object")SqueezeBox.addEvent("onOpen",r);else jQuery(ARK.squeezeBox).on("onOpen",r);if(typeof SqueezeBox=="object")SqueezeBox.addEvent("onOpen",u);else jQuery(ARK.squeezeBox).on("onOpen",u)}}},f=i.addCommand(n,u),r;f.modes={wysiwyg:1};r=CKEDITOR.plugins.link.getSelectedLink2=function(n){var t=n.getSelectedWidget()||null;return t&&(t.inline?!t.wrapper.getAscendant("a"):1)?t.parts.link:CKEDITOR.plugins.link.getSelectedLink(n)||!1};i.on("doubleclick",function(u){var f=r(i)||u.data.element;if(!f.isReadOnly())if(f.is("a")){if(f.getAttribute("name")||!f.getAttribute("href")&&f.getChildCount())f.getAttribute("name")&&(!f.getAttribute("href")||f.getChildCount())&&(u.data.dialog="anchor");else if(t.test(f.getAttribute("href")))return setTimeout(function(){i.execCommand(n)},0),!1}else CKEDITOR.plugins.link.tryRestoreFakeAnchor(i,f)&&(u.data.dialog="anchor")},null,null,5);i.addMenuItems&&i.addMenuItems({document:{label:i.lang.document.menu,command:n,group:"link",order:1}});i.ui.addButton&&i.ui.addButton("Document",{label:i.lang.document.toolbar,command:n});i.contextMenu&&i.contextMenu.addListener(function(n){var r,u;return!n||n.isReadOnly()?null:(r=CKEDITOR.plugins.link.tryRestoreFakeAnchor(i,n),!r&&!(r=CKEDITOR.plugins.link.getSelectedLink2(i)))?null:(u={},r.getAttribute("href")&&r.getChildCount()&&t.test(r.getAttribute("href"))&&(u={document:CKEDITOR.TRISTATE_OFF}),u)})},afterInit:function(n){if(!n.config.arkMediaEnabled)n.widgets.on("instanceCreated",function(n){var i=n.data;if(i.inline)i.on("contextMenu",function(n){n.data.image=CKEDITOR.TRISTATE_OFF;var i=this.parts.link||this.wrapper.getAscendant("a");i&&t.test(i.getAttribute("href"))&&(n.data.document=CKEDITOR.TRISTATE_OFF)})})}})})()