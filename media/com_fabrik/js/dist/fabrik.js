/*! Fabrik */

define(["jquery","fab/loader","fab/requestqueue"],function(u,e,t){var o=u(document);document.addEvent("click:relay(.popover button.close)",function(e,t){var o="#"+t.get("data-popover"),i=document.getElement(o);u(o).popover("hide"),"null"!==typeOf(i)&&"input"===i.get("tag")&&(i.checked=!1)});var f={events:{},bootstrapVersion:function(e){var t,o=[e||"modal","tooltip"],i=o.length;for(t=0;t<i;++t){var n=u.fn[o[t]];if(n){if(n.VERSION)return n.VERSION.match(/(\d+)\./)[0].toInt();if(n.Constructor&&n.Constructor.VERSION)return n.Constructor.VERSION.match(/(\d+)\./)[0].toInt()}}return 2},Windows:{}};return f.loader=new e,f.blocks={},f.periodicals={},f.addBlock=function(e,t){f.blocks[e]=t,f.fireEvent("fabrik.block.added",[t,e])},f.getBlock=function(e,t,o){return(o=o||!1)&&(f.periodicals[e]=f._getBlock.periodical(500,this,[e,t,o])),f._getBlock(e,t,o)},f._getBlock=function(e,t,o){var i;if(t=t||!1,void 0!==f.blocks[e])i=e;else{if(t)return!1;var n=Object.keys(f.blocks),a=n.searchFor(e);if(-1===a)return!1;i=n[a]}return o&&(clearInterval(f.periodicals[e]),o(f.blocks[i])),f.blocks[i]},o.on("click",".fabrik_delete a, .fabrik_action a.delete, .btn.delete",function(e){e.rightClick||f.watchDelete(e,this)}),o.on("click",".fabrik_edit a, a.fabrik_edit",function(e){e.rightClick||f.watchEdit(e,this)}),o.on("click",".fabrik_view a, a.fabrik_view",function(e){e.rightClick||f.watchView(e,this)}),document.addEvent("click:relay(*[data-fabrik-view])",function(e,t){if(!e.rightClick){var o,i,n;e.preventDefault(),o=(i="a"===e.target.get("tag")?e.target:"null"!==typeOf(e.target.getElement("a"))?e.target.getElement("a"):e.target.getParent("a")).get("href"),o+=o.contains("?")?"&tmpl=component&ajax=1":"?tmpl=component&ajax=1",o+="&format=partial",$H(f.Windows).each(function(e,t){e.close()}),(n=i.get("title"))||(n=Joomla.JText._("COM_FABRIK_VIEW"));var a={id:"view."+o,title:n,loadMethod:"xhr",contentURL:o};f.getWindow(a)}}),f.removeEvent=function(e,t){if(f.events[e]){var o=f.events[e].indexOf(t);-1!==o&&delete f.events[e][o]}},f.addEvent=f.on=function(e,t){f.events[e]||(f.events[e]=[]),f.events[e].contains(t)||f.events[e].push(t)},f.addEvents=function(e){var t;for(t in e)e.hasOwnProperty(t)&&f.addEvent(t,e[t]);return this},f.fireEvent=f.trigger=function(e,t,o){var i=f.events;return this.eventResults=[],i&&i[e]&&(t=Array.from(t),i[e].each(function(e){o?this.eventResults.push(e.delay(o,this,t)):this.eventResults.push(e.apply(this,t))},this)),this},f.requestQueue=new t,f.cbQueue={google:[]},f.loadGoogleMap=function(e,t){var o=("https:"===document.location.protocol?"https:":"http:")+"//maps.googleapis.com/maps/api/js?libraries=places,visualization&callback=Fabrik.mapCb";if(!1!==e&&(o+="&key="+e),0===Array.from(document.scripts).filter(function(e){return e.src===o}).length){var i=document.createElement("script");i.type="text/javascript",i.src=o,document.body.appendChild(i),f.cbQueue.google.push(t)}else f.googleMap?window[t]():f.cbQueue.google.push(t)},f.mapCb=function(){var e,t;for(f.googleMap=!0,t=0;t<f.cbQueue.google.length;t++)e=f.cbQueue.google[t],"function"===typeOf(e)?e():window[e]();f.cbQueue.google=[]},f.watchDelete=function(e,t){var o,i,n;if((n=e.target.getParent(".fabrik_row"))||(n=f.activeRow),n){var a=n.getElement("input[type=checkbox][name*=id]");"null"!==typeOf(a)&&(a.checked=!0),i=(i=n.id.split("_")).splice(0,i.length-2).join("_"),o=f.blocks[i]}else if(i=e.target.getParent(".fabrikList"),"null"!==typeOf(i))i=i.id,o=f.blocks[i];else{var r=t.getParent(".floating-tip-wrapper");if(r)i=r.retrieve("list").id;else i=t.get("data-listRef");void 0===(o=f.blocks[i])||"floating"!==o.options.actionMethod||this.bootstrapped||o.form.getElements("input[type=checkbox][name*=id], input[type=checkbox][name=checkAll]").each(function(e){e.checked=!0})}o.submit("list.delete")||e.preventDefault()},f.watchEdit=function(e,t){f.openSingleView("form",e,t)},f.watchView=function(e,t){f.openSingleView("details",e,t)},f.openSingleView=function(o,e,t){var i,n,a,r,l,c,s,p=u(t).data("list"),d=f.blocks[p];if(1===u(t).data("isajax")){if(d){if(!d.options.ajax_links)return;if(!(c=d.getActiveRow(e))||0===c.length)return;d.setActive(c),l=c.prop("id").split("_").pop()}else l=u(t).data("rowid");e.preventDefault(),i=(a="A"===u(e.target).prop("tagName")?u(e.target):0<u(e.target).find("a").length?u(e.target).find("a"):u(e.target).closest("a")).prop("href"),1!==u(t).data("iscustom")&&(i+=i.contains("?")?"&tmpl=component&ajax=1":"?tmpl=component&ajax=1",i+="&format=partial"),r=a.prop("title"),void 0===(n=a.data("loadmethod"))&&(n="xhr"),u.each(f.Windows,function(e,t){t.close()}),s={modalId:"ajax_links",id:p+"."+l,title:r,loadMethod:n,contentURL:i,onClose:function(){var e=o+"_"+d.options.formid+"_"+l;try{f.blocks[e].destroyElements(),f.blocks[e].formElements=null,f.blocks[e]=null,delete f.blocks[e];var t="details"===o?"fabrik.list.row.view.close":"fabrik.list.row.edit.close";f.fireEvent(t,[p,l,e])}catch(e){console.log(e)}}},d&&(""!==d.options.popup_width&&(s.width=d.options.popup_width),""!==d.options.popup_height&&(s.height=d.options.popup_height),s.id="details"===o?"view."+s.id:"add."+s.id,null!==d.options.popup_offset_x&&(s.offset_x=d.options.popup_offset_x),null!==d.options.popup_offset_y&&(s.offset_y=d.options.popup_offset_y)),f.getWindow(s)}},f.Array={chunk:function(e,t){var o,i,n=[];for(o=0,i=e.length;o<i;o+=t)n.push(e.slice(o,o+t));return n}},window.fireEvent("fabrik.loaded"),window.Fabrik=f});